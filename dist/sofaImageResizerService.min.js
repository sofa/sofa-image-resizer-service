/**
 * sofa-image-resizer-service - v0.3.0 - Wed Apr 08 2015 10:08:03 GMT+0200 (CEST)
 * http://www.sofa.io
 *
 * Copyright (c) 2014 CouchCommerce GmbH (http://www.couchcommerce.com / http://www.sofa.io) and other contributors
 * THIS SOFTWARE CONTAINS COMPONENTS OF THE SOFA.IO COUCHCOMMERCE SDK (WWW.SOFA.IO)
 * IT IS PROVIDED UNDER THE LICENSE TERMS OF THE ATTACHED LICENSE.TXT.
 */
!function(e){"use strict";e.define("sofa.ImageResizerService",function(t,i){function r(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i+"="+e[i]);return t.join("&")}function a(e){var t=e.split("&"),i={};return t.forEach(function(e){e=e.split("="),i[e[0]]=decodeURIComponent(e[1]||"")}),JSON.parse(JSON.stringify(i))}var n=function(e){if("function"==typeof i.btoa)return i.btoa(e);var t,r,a,n,o,c,h,s,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=0,l=0,f="",g=[];if(!e)return e;do t=e.charCodeAt(d++),r=e.charCodeAt(d++),a=e.charCodeAt(d++),s=t<<16|r<<8|a,n=s>>18&63,o=s>>12&63,c=s>>6&63,h=63&s,g[l++]=u.charAt(n)+u.charAt(o)+u.charAt(c)+u.charAt(h);while(d<e.length);f=g.join("");var v=e.length%3;return(v?f.slice(0,v-3):f)+"===".slice(v||3)},o={},c={};return c.resize=function(c,h){if(!t.get("imageResizerEnabled"))return c;var s;if(s=e.Util.isString(h)?c+h:c+r(h),o[s])return o[s];if(e.Util.isString(h)&&(h=a(h)),!h||!h.hasOwnProperty("maxwidth")||!h.hasOwnProperty("maxheight"))throw new Error("maxwidth and maxheight are required parameters");/^\/\//.test(c)&&(c=i.location.protocol+c);var u={cmd:"resize",url:encodeURI(c),quality:100,devicePixelRatio:i.devicePixelRatio},d=e.Util.extend(h,u),l=c.substring(c.lastIndexOf(".")+1);h.devicePixelRatio>1&&(d.maxwidth*=h.devicePixelRatio,d.maxheight*=h.devicePixelRatio);var f=n(r(d)).replace("/","_").match(/.{1,250}/g).join("/")+"."+l,g=t.get("imageResizer")+f;return o[s]=g,g},c})}(sofa,document);