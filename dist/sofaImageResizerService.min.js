/**
 * sofa-image-resizer-service - v0.3.0 - Fri May 15 2015 11:40:45 GMT+0200 (CEST)
 * http://www.sofa.io
 *
 * Copyright (c) 2014 CouchCommerce GmbH (http://www.couchcommerce.com / http://www.sofa.io) and other contributors
 * THIS SOFTWARE CONTAINS COMPONENTS OF THE SOFA.IO COUCHCOMMERCE SDK (WWW.SOFA.IO)
 * IT IS PROVIDED UNDER THE LICENSE TERMS OF THE ATTACHED LICENSE.TXT.
 */
!function(e,i,t){"use strict";function r(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,i){for(var t=0;t<i.length;t++){var r=i[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(i,t,r){return t&&e(i.prototype,t),r&&e(i,r),i}}(),o=function(){function i(e,t){r(this,i),this.configService=e,this.$window=t,this.resizeUrlCache={}}return n(i,[{key:"base64Encode",value:function(e){if("function"==typeof this.$window.btoa)return this.$window.btoa(e);var i,t,r,n,o,a,c,s,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u=0,l=0,f="",d=[];if(!e)return e;do i=e.charCodeAt(u++),t=e.charCodeAt(u++),r=e.charCodeAt(u++),s=i<<16|t<<8|r,n=s>>18&63,o=s>>12&63,a=s>>6&63,c=63&s,d[l++]=h.charAt(n)+h.charAt(o)+h.charAt(a)+h.charAt(c);while(u<e.length);f=d.join("");var g=e.length%3;return(g?f.slice(0,g-3):f)+"===".slice(g||3)}},{key:"objectToQueryString",value:function(e){var i=[];for(var t in e)e.hasOwnProperty(t)&&i.push(t+"="+e[t]);return i.join("&")}},{key:"queryStringToObject",value:function(e){var i=e.split("&"),t={};return i.forEach(function(e){e=e.split("="),t[e[0]]=decodeURIComponent(e[1]||"")}),JSON.parse(JSON.stringify(t))}},{key:"resize",value:function(i,t){if(!this.configService.get("imageResizerEnabled"))return i;var r;if(r=e.Util.isString(t)?i+t:i+this.objectToQueryString(t),this.resizeUrlCache[r])return this.resizeUrlCache[r];if(e.Util.isString(t)&&(t=this.queryStringToObject(t)),!t||!t.hasOwnProperty("maxwidth")||!t.hasOwnProperty("maxheight"))throw new Error("maxwidth and maxheight are required parameters");/^\/\//.test(i)&&(i=this.$window.location.protocol+i);var n={cmd:"resize",url:encodeURI(i),quality:100,devicePixelRatio:this.$window.devicePixelRatio},o=e.Util.extend(t,n),a=i.substring(i.lastIndexOf(".")+1);t.devicePixelRatio>1&&(o.maxwidth*=t.devicePixelRatio,o.maxheight*=t.devicePixelRatio);var c=this.base64Encode(this.objectToQueryString(o)).replace("/","_").match(/.{1,250}/g).join("/")+"."+a,s=this.configService.get("imageResizer")+c;return this.resizeUrlCache[r]=s,s}}]),i}();e&&e.define("sofa.ImageResizerService",function(e,i){return new o(e,i)})}(sofa,document);