/**
 * sofa-image-resizer-service - v0.3.0 - Fri May 15 2015 11:40:45 GMT+0200 (CEST)
 * http://www.sofa.io
 *
 * Copyright (c) 2014 CouchCommerce GmbH (http://www.couchcommerce.com / http://www.sofa.io) and other contributors
 * THIS SOFTWARE CONTAINS COMPONENTS OF THE SOFA.IO COUCHCOMMERCE SDK (WWW.SOFA.IO)
 * IT IS PROVIDED UNDER THE LICENSE TERMS OF THE ATTACHED LICENSE.TXT.
 */
!function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=function(){function t(e,i){r(this,t),this.configService=e,this.$window=i,this.resizeUrlCache={}}return n(t,[{key:"base64Encode",value:function(e){if("function"==typeof this.$window.btoa)return this.$window.btoa(e);var t,i,r,n,o,a,c,s,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h=0,l=0,f="",d=[];if(!e)return e;do t=e.charCodeAt(h++),i=e.charCodeAt(h++),r=e.charCodeAt(h++),s=t<<16|i<<8|r,n=s>>18&63,o=s>>12&63,a=s>>6&63,c=63&s,d[l++]=u.charAt(n)+u.charAt(o)+u.charAt(a)+u.charAt(c);while(h<e.length);f=d.join("");var v=e.length%3;return(v?f.slice(0,v-3):f)+"===".slice(v||3)}},{key:"objectToQueryString",value:function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i+"="+e[i]);return t.join("&")}},{key:"queryStringToObject",value:function(e){var t=e.split("&"),i={};return t.forEach(function(e){e=e.split("="),i[e[0]]=decodeURIComponent(e[1]||"")}),JSON.parse(JSON.stringify(i))}},{key:"resize",value:function(t,i){if(!this.configService.get("imageResizerEnabled"))return t;var r;if(r=e.Util.isString(i)?t+i:t+this.objectToQueryString(i),this.resizeUrlCache[r])return this.resizeUrlCache[r];if(e.Util.isString(i)&&(i=this.queryStringToObject(i)),!i||!i.hasOwnProperty("maxwidth")||!i.hasOwnProperty("maxheight"))throw new Error("maxwidth and maxheight are required parameters");/^\/\//.test(t)&&(t=this.$window.location.protocol+t);var n={cmd:"resize",url:encodeURI(t),quality:100,devicePixelRatio:this.$window.devicePixelRatio},o=e.Util.extend(i,n),a=t.substring(t.lastIndexOf(".")+1);i.devicePixelRatio>1&&(o.maxwidth*=i.devicePixelRatio,o.maxheight*=i.devicePixelRatio);var c=this.base64Encode(this.objectToQueryString(o)).replace("/","_").match(/.{1,250}/g).join("/")+"."+a,s=this.configService.get("imageResizer")+c;return this.resizeUrlCache[r]=s,s}}]),t}();e&&e.define("sofa.ImageResizerService",function(e,t){return new o(e,t)}),exports["default"]=o,module.exports=exports["default"]}(sofa,document);