/**
 * sofa-image-resizer-service - v0.1.1 - 2014-06-18
 * http://www.sofa.io
 *
 * Copyright (c) 2014 CouchCommerce GmbH (http://www.couchcommerce.com / http://www.sofa.io) and other contributors
 * THIS SOFTWARE CONTAINS COMPONENTS OF THE SOFA.IO COUCHCOMMERCE SDK (WWW.SOFA.IO).
 * IT IS PROVIDED UNDER THE LICENSE TERMS OF THE ATTACHED LICENSE.TXT.
 */
!function(a){"use strict";a.define("sofa.ImageResizerService",function(b,c){function d(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}function e(a){var b=a.split("&"),c={};return b.forEach(function(a){a=a.split("="),c[a[0]]=decodeURIComponent(a[1]||"")}),JSON.parse(JSON.stringify(c))}var f=function(a){if("function"==typeof c.btoa)return c.btoa(a);var b,d,e,f,g,h,i,j,k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=0,m=0,n="",o=[];if(!a)return a;do b=a.charCodeAt(l++),d=a.charCodeAt(l++),e=a.charCodeAt(l++),j=b<<16|d<<8|e,f=j>>18&63,g=j>>12&63,h=j>>6&63,i=63&j,o[m++]=k.charAt(f)+k.charAt(g)+k.charAt(h)+k.charAt(i);while(l<a.length);n=o.join("");var p=a.length%3;return(p?n.slice(0,p-3):n)+"===".slice(p||3)},g={},h={};return h.resize=function(h,i){if(!b.get("imageResizerEnabled"))return h;var j;if(j=a.Util.isString(i)?h+i:h+d(i),g[j])return g[j];if(a.Util.isString(i)&&(i=e(i)),!i||!i.hasOwnProperty("maxwidth")||!i.hasOwnProperty("maxheight"))throw new Error("maxwidth and maxheight are required parameters");/^\/\//.test(h)&&(h=c.location.protocol+h);var k={cmd:"resize",url:h,quality:100,devicePixelRatio:c.devicePixelRatio},l=a.Util.extend(i,k),m=h.substring(h.lastIndexOf(".")+1);i.devicePixelRatio>1&&(l.maxwidth*=i.devicePixelRatio,l.maxheight*=i.devicePixelRatio);var n=f(d(l)).replace("/","_")+"."+m,o=b.get("imageResizerEndpoint")+n;return g[j]=o,o},h})}(sofa);