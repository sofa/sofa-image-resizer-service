/**
 * sofa-image-resizer-service - v0.1.0 - 2014-04-16
 * http://www.sofa.io
 *
 * Copyright (c) 2014 CouchCommerce GmbH (http://www.couchcommerce.com / http://www.sofa.io) and other contributors
 * THIS SOFTWARE CONTAINS COMPONENTS OF THE SOFA.IO COUCHCOMMERCE SDK (WWW.SOFA.IO).
 * IT IS PROVIDED UNDER THE LICENSE TERMS OF THE ATTACHED LICENSE.TXT.
 */
!function(a){"use strict";a.define("sofa.ImageResizerService",function(b,c){function d(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}function e(a){var b=a.split("&"),c={};return b.forEach(function(a){a=a.split("="),c[a[0]]=decodeURIComponent(a[1]||"")}),JSON.parse(JSON.stringify(c))}var f={},g={};return g.resize=function(g,h){if(!b.get("imageResizerEnabled"))return g;var i;if(i=a.Util.isString(h)?g+h:g+d(h),f[i])return f[i];if(a.Util.isString(h)&&(h=e(h)),!h||!h.hasOwnProperty("maxwidth")||!h.hasOwnProperty("maxheight"))throw new Error("maxwidth and maxheight are required parameters");/^\/\//.test(g)&&(g=c.location.protocol+g);var j={cmd:"resize",url:g,quality:100,devicePixelRatio:c.devicePixelRatio},k=a.Util.extend(h,j),l=g.substring(g.lastIndexOf(".")+1);h.devicePixelRatio>1&&(k.maxwidth*=h.devicePixelRatio,k.maxheight*=h.devicePixelRatio);var m=c.btoa(d(k)).replace("/","_")+"."+l,n=b.get("imageResizerEndpoint")+m;return f[i]=n,n},g})}(sofa);